<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Snake terraplanista =)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
    body {
        background: #111;
        color: #fff;
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 0;
        padding-top: 10px;
        width: 100%;
        overflow-x: hidden;
    }

    #container {
        text-align: center;
        width: 100%;
    }

    /* CANVAS RESPONSIVE */
    #canvasWrapper {
        width: 100%;
        max-width: 480px;
        margin: 0 auto;
    }

    canvas {
        width: 100% !important;
        height: auto !important;
        display: none;
        background: #000;
        border: 3px solid #0f0;
        image-rendering: pixelated;
        margin-bottom: 30px;
    }

    /* BOTONES T츼CTILES con separaci칩n amplia */
    #touchControls {
        width: 300px;
        margin: 35px auto 0 auto;
        display: none;
    }

    .dpad-row {
        display: flex;
        justify-content: center;
        margin: 25px 0;
    }

    .dpad-btn {
        width: 95px;
        height: 95px;
        background: rgba(0,255,0,0.25);
        border: 3px solid #0f0;
        border-radius: 20px;
        font-size: 38px;
        color: #0f0;
        user-select: none;
        margin: 0 25px;
    }
</style>
</head>

<body>

<div id="container">

    <!-- MEN칔 -->
    <div id="menu">
        <h1>游냀 Snake iPhone Terraplanista =)</h1>

        <p><b>Nivel:</b></p>
        <select id="levelSelect">
            <option value="150">F치cil</option>
            <option value="100">Normal</option>
            <option value="60">Dif칤cil</option>
            <option value="40">Insano</option>
        </select>

        <p><b>Sonido:</b></p>
        <select id="soundSelect">
            <option value="on">Activado</option>
            <option value="off">Desactivado</option>
        </select>

        <br><br>
        <button onclick="startGame()">Iniciar Juego</button>
    </div>

    <!-- PUNTUACI칍N -->
    <div id="scoreBox" style="display:none; font-size:22px; margin-bottom:15px;">
        Puntuaci칩n: <span id="score">0</span>
    </div>

    <!-- CANVAS -->
    <div id="canvasWrapper">
        <canvas id="game" width="480" height="480"></canvas>
    </div>

    <!-- CONTROLES T츼CTILES -->
    <div id="touchControls">
        <div class="dpad-row"><button class="dpad-btn" id="btnUp">拘勇</button></div>
        <div class="dpad-row">
            <button class="dpad-btn" id="btnLeft">拘勇</button>
            <button class="dpad-btn" id="btnRight">俱뫮잺</button>
        </div>
        <div class="dpad-row"><button class="dpad-btn" id="btnDown">拘勇</button></div>
    </div>

    <!-- GAME OVER -->
    <div id="gameOver" style="display:none;">
        <h1>游 Fin del juego</h1>
        <p>Puntuaci칩n: <span id="finalScore"></span></p>
        <button onclick="startGame()">Jugar otra vez</button>
        <button onclick="location.reload()">Men칰</button>
    </div>

</div>

<script>
// ------------------------------
// VARIABLES PRINCIPALES
// ------------------------------
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let snake = [];
let food = {};
let dx = 20, dy = 0;
let score = 0;
let speed = 150;
let running = false;
let gameLoop;
let soundEnabled = true;

// ------------------------------
// SONIDOS
// ------------------------------
const eatSound = new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");
const gameOverSound = new Audio("https://actions.google.com/sounds/v1/cartoon/concussive_hit_guitar_boing.ogg");

// ------------------------------
// CANVAS RESPONSIVE
// ------------------------------
function resizeCanvas() {
    const wrapper = document.getElementById("canvasWrapper");
    const size = Math.min(wrapper.clientWidth, window.innerHeight * 0.6);
    canvas.style.width = size + "px";
    canvas.style.height = size + "px";
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

// ------------------------------
// INICIO DE JUEGO
// ------------------------------
function startGame() {
    speed = parseInt(document.getElementById("levelSelect").value);
    soundEnabled = document.getElementById("soundSelect").value === "on";

    snake = [
        { x: 200, y: 200 },
        { x: 180, y: 200 }
    ];
    dx = 20;
    dy = 0;

    score = 0;
    document.getElementById("score").innerText = score;

    document.getElementById("menu").style.display = "none";
    document.getElementById("gameOver").style.display = "none";
    document.getElementById("game").style.display = "block";
    document.getElementById("scoreBox").style.display = "block";
    document.getElementById("touchControls").style.display = "block";

    spawnFood();
    running = true;

    clearInterval(gameLoop);
    gameLoop = setInterval(update, speed);
}

// ------------------------------
// LOOP PRINCIPAL
// ------------------------------
function update() {
    if (!running) return;

    moveSnake();

    if (checkCollision()) {
        endGame();
        return;
    }

    draw();
}

// ------------------------------
// MOVIMIENTO
// ------------------------------
function moveSnake() {
    const head = { x: snake[0].x + dx, y: snake[0].y + dy };
    snake.unshift(head);

    if (head.x === food.x && head.y === food.y) {
        score++;
        document.getElementById("score").innerText = score;
        spawnFood();
        if (soundEnabled) eatSound.play();
    } else {
        snake.pop();
    }
}

// ------------------------------
// SPAWN COMIDA
// ------------------------------
function spawnFood() {
    food = {
        x: Math.floor(Math.random() * 24) * 20,
        y: Math.floor(Math.random() * 24) * 20
    };
}

// ------------------------------
// DIBUJAR
// ------------------------------
function draw() {
    ctx.clearRect(0, 0, 480, 480);

    // comida
    ctx.fillStyle = "#ff0000";
    ctx.fillRect(food.x, food.y, 20, 20);

    // serpiente simple en verde
    ctx.fillStyle = "#00ff00";
    snake.forEach(seg => {
        ctx.fillRect(seg.x, seg.y, 20, 20);
    });
}

// ------------------------------
// COLISIONES
// ------------------------------
function checkCollision() {
    const head = snake[0];
    if (head.x < 0 || head.x >= 480 || head.y < 0 || head.y >= 480)
        return true;

    for (let i=1; i<snake.length; i++) {
        if (head.x === snake[i].x && head.y === snake[i].y)
            return true;
    }

    return false;
}

// ------------------------------
// GAME OVER
// ------------------------------
function endGame() {
    running = false;
    clearInterval(gameLoop);
    if (soundEnabled) gameOverSound.play();

    document.getElementById("finalScore").innerText = score;
    document.getElementById("game").style.display = "none";
    document.getElementById("touchControls").style.display = "none";
    document.getElementById("gameOver").style.display = "block";
}

// ------------------------------
// CONTROLES T츼CTILES
// ------------------------------
document.getElementById("btnUp").addEventListener("touchstart", () => {
    if (dy === 0) { dx = 0; dy = -20; }
});
document.getElementById("btnDown").addEventListener("touchstart", () => {
    if (dy === 0) { dx = 0; dy = 20; }
});
document.getElementById("btnLeft").addEventListener("touchstart", () => {
    if (dx === 0) { dx = -20; dy = 0; }
});
document.getElementById("btnRight").addEventListener("touchstart", () => {
    if (dx === 0) { dx = 20; dy = 0; }
});
</script>

</body>
</html>
