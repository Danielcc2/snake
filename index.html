<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Snake iPhone Responsive</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
    body {
        background: #111;
        color: #fff;
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 0;
        padding-top: 10px;
        width: 100%;
        overflow-x: hidden;
    }

    #container {
        text-align: center;
        width: 100%;
    }

    /* WRAPPER DEL CANVAS */
    #canvasWrapper {
        width: 100%;
        margin: 0 auto;
    }

    canvas {
        width: 100%;
        height: auto;
        display: none;
        background: #000;
        border: 3px solid #0f0;
        image-rendering: pixelated;
        margin-bottom: 20px;
    }

    /* CONTROLES T√ÅCTILES */
    #touchControls {
        display: none;
    }

    .dpad-row {
        display: flex;
        justify-content: center;
        margin: 15px 0;
    }

    .dpad-btn {
        background: rgba(0,255,0,0.25);
        border: 3px solid #0f0;
        border-radius: 20px;
        user-select: none;
        color: #0f0;
        font-weight: bold;
    }
</style>
</head>

<body>

<div id="container">

    <!-- MEN√ö -->
    <div id="menu">
        <h1>üêç Snake Terraplanista</h1>

        <p><b>Elige tu dispositivo:</b></p>
        <select id="deviceSelect">
            <option value="small">iPhone / iPhone Mini</option>
            <option value="medium">iPhone Pro</option>
            <option value="large" selected>iPhone Pro Max</option>
        </select>

        <p><b>Nivel:</b></p>
        <select id="levelSelect">
            <option value="150">F√°cil</option>
            <option value="100">Normal</option>
            <option value="60">Dif√≠cil</option>
            <option value="40">Insano</option>
        </select>

        <br><br>
        <button onclick="startGame()">Iniciar Juego</button>
    </div>

    <!-- PUNTUACI√ìN -->
    <div id="scoreBox" style="display:none; font-size:22px; margin-bottom:15px;">
        Puntuaci√≥n: <span id="score">0</span>
    </div>

    <!-- CANVAS -->
    <div id="canvasWrapper">
        <canvas id="game" width="480" height="480"></canvas>
    </div>

    <!-- CONTROLES T√ÅCTILES -->
    <div id="touchControls">
        <div class="dpad-row"><button class="dpad-btn" id="btnUp">‚¨ÜÔ∏è</button></div>
        <div class="dpad-row">
            <button class="dpad-btn" id="btnLeft">‚¨ÖÔ∏è</button>
            <button class="dpad-btn" id="btnRight">‚û°Ô∏è</button>
        </div>
        <div class="dpad-row"><button class="dpad-btn" id="btnDown">‚¨áÔ∏è</button></div>
    </div>

    <!-- GAME OVER -->
    <div id="gameOver" style="display:none;">
        <h1>üíÄ Fin del juego</h1>
        <p>Puntuaci√≥n: <span id="finalScore"></span></p>
        <button onclick="startGame()">Jugar otra vez</button>
        <button onclick="location.reload()">Men√∫</button>
    </div>

</div>


<script>
// -----------------------------------------------------------------------
// VARIABLES
// -----------------------------------------------------------------------
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let snake = [];
let food = {};
let dx = 20, dy = 0;
let score = 0;
let speed = 150;
let running = false;
let gameLoop;

// -----------------------------------------------------------------------
// AJUSTE RESPONSIVE SEG√öN DISPOSITIVO
// -----------------------------------------------------------------------
function setDeviceLayout() {
    const device = document.getElementById("deviceSelect").value;

    const controls = document.getElementById("touchControls");
    const buttons = document.querySelectorAll(".dpad-btn");
    const wrapper = document.getElementById("canvasWrapper");

    if (device === "small") {             // iPhone peque√±o
        wrapper.style.maxWidth = "320px";
        buttons.forEach(btn => {
            btn.style.width = "70px";
            btn.style.height = "70px";
            btn.style.fontSize = "28px";
            btn.style.margin = "0 10px";
        });
    }

    if (device === "medium") {            // iPhone Pro
        wrapper.style.maxWidth = "380px";
        buttons.forEach(btn => {
            btn.style.width = "85px";
            btn.style.height = "85px";
            btn.style.fontSize = "32px";
            btn.style.margin = "0 15px";
        });
    }

    if (device === "large") {            // iPhone Pro Max
        wrapper.style.maxWidth = "480px";
        buttons.forEach(btn => {
            btn.style.width = "95px";
            btn.style.height = "95px";
            btn.style.fontSize = "38px";
            btn.style.margin = "0 25px";
        });
    }
}

// Aplicar cambios al seleccionar dispositivo
document.getElementById("deviceSelect").addEventListener("change", setDeviceLayout);

// -----------------------------------------------------------------------
// INICIO DE JUEGO
// -----------------------------------------------------------------------
function startGame() {

    setDeviceLayout(); // ‚Üê aplicar el tama√±o correcto antes de iniciar

    speed = parseInt(document.getElementById("levelSelect").value);

    snake = [
        { x: 200, y: 200 },
        { x: 180, y: 200 }
    ];
    dx = 20;
    dy = 0;

    score = 0;
    document.getElementById("score").innerText = score;

    document.getElementById("menu").style.display = "none";
    document.getElementById("gameOver").style.display = "none";
    document.getElementById("game").style.display = "block";
    document.getElementById("scoreBox").style.display = "block";
    document.getElementById("touchControls").style.display = "block";

    spawnFood();
    running = true;

    clearInterval(gameLoop);
    gameLoop = setInterval(update, speed);
}

// -----------------------------------------------------------------------
// JUEGO (funciones iguales que antes)
// -----------------------------------------------------------------------
function update() {
    if (!running) return;
    moveSnake();
    if (checkCollision()) return endGame();
    draw();
}

function moveSnake() {
    const head = { x: snake[0].x + dx, y: snake[0].y + dy };
    snake.unshift(head);

    if (head.x === food.x && head.y === food.y) {
        score++;
        document.getElementById("score").innerText = score;
        spawnFood();
    } else {
        snake.pop();
    }
}

function spawnFood() {
    food = {
        x: Math.floor(Math.random() * 24) * 20,
        y: Math.floor(Math.random() * 24) * 20
    };
}

function draw() {
    ctx.clearRect(0, 0, 480, 480);

    ctx.fillStyle = "#ff0000";
    ctx.fillRect(food.x, food.y, 20, 20);

    ctx.fillStyle = "#00ff00";
    snake.forEach(seg => {
        ctx.fillRect(seg.x, seg.y, 20, 20);
    });
}

function checkCollision() {
    const h = snake[0];

    if (h.x < 0 || h.x >= 480 || h.y < 0 || h.y >= 480)
        return true;

    for (let i = 1; i < snake.length; i++)
        if (h.x === snake[i].x && h.y === snake[i].y)
            return true;

    return false;
}

function endGame() {
    running = false;
    clearInterval(gameLoop);

    document.getElementById("finalScore").innerText = score;
    document.getElementById("game").style.display = "none";
    document.getElementById("touchControls").style.display = "none";
    document.getElementById("gameOver").style.display = "block";
}

// -----------------------------------------------------------------------
// CONTROLES
// -----------------------------------------------------------------------
document.getElementById("btnUp").addEventListener("touchstart", () => { if (dy === 0) { dx = 0; dy = -20; }});
document.getElementById("btnDown").addEventListener("touchstart", () => { if (dy === 0) { dx = 0; dy = 20; }});
document.getElementById("btnLeft").addEventListener("touchstart", () => { if (dx === 0) { dx = -20; dy = 0; }});
document.getElementById("btnRight").addEventListener("touchstart", () => { if (dx === 0) { dx = 20; dy = 0; }});
</script>

</body>
</html>

